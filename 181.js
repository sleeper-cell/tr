"use strict";(self.webpackChunkbrowser_extension_wallet=self.webpackChunkbrowser_extension_wallet||[]).push([["181"],{71773:function(e,t,r){r.r(t),r.d(t,{default:()=>T});var n=r(30261),a=r(48990),o=r(20763),i=r(79151),l=r(43057),s=r(96330),u=r(99469),c=r(12607),_=r(67294),f=r(65048),h=r(4184),y=r(97509),d=r(53099),useAllChainsFetchedTransactionsPeriod=function(){var e=l.h.getState(),t=e.tx,r=e.wallet;return(0,_.useMemo)(function(){var e,n;return null!=(n=null==(e=t.fetchedAllChainsTransactionPeriods)?void 0:e[r.walletId])?n:{}},[t.fetchedAllChainsTransactionPeriods,r.walletId])},p=r(95483),b=r(12820);function _array_like_to_array(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function _array_with_holes(e){if(Array.isArray(e))return e}function asyncGeneratorStep(e,t,r,n,a,o,i){try{var l=e[o](i),s=l.value}catch(e){r(e);return}l.done?t(s):Promise.resolve(s).then(n,a)}function _async_to_generator(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var o=e.apply(t,r);function _next(e){asyncGeneratorStep(o,n,a,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(o,n,a,_next,_throw,"throw",e)}_next(void 0)})}}function _iterable_to_array_limit(e,t){var r,n,a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var o=[],i=!0,l=!1;try{for(a=a.call(e);!(i=(r=a.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(e){l=!0,n=e}finally{try{i||null==a.return||a.return()}finally{if(l)throw n}}return o}}function _non_iterable_rest(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _sliced_to_array(e,t){return _array_with_holes(e)||_iterable_to_array_limit(e,t)||_unsupported_iterable_to_array(e,t)||_non_iterable_rest()}function _unsupported_iterable_to_array(e,t){if(e){if("string"==typeof e)return _array_like_to_array(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _array_like_to_array(e,t)}}function _ts_generator(e,t){var r,n,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function verb(e){return function(t){return step([e,t])}}function step(o){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(a=2&o[0]?n.return:o[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,n=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],n=0}finally{r=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}}function useFetchMultipleChainsTransactions(){var e,t=(0,d.O)(),r=useAllChainsFetchedTransactionsPeriod(),n=r.from,a=r.to,o=r.blockchains,i=r.nextToken,m=(0,b.R)(!0),g=(0,u.NL)(),v=_sliced_to_array((0,_.useState)(new Date),2),w=v[0],S=v[1],T=_sliced_to_array((0,_.useState)((0,p.n9)(new Date,29)),2),x=T[0],k=T[1],A=_sliced_to_array((0,_.useState)(!1),2),C=A[0],I=A[1],P=_sliced_to_array((0,_.useState)(!1),2),N=P[0],O=P[1],D=_sliced_to_array((0,_.useState)(i),2),F=D[0],E=D[1],M=_sliced_to_array((0,_.useState)([]),2),H=M[0],j=M[1],R=_sliced_to_array((0,_.useState)(!0),2),G=R[0],L=R[1],K=(0,_.useRef)(0),Z=(0,_.useMemo)(function(){return m.filter(function(e){return!H.includes(e.id)})},[m,H]),q=(0,_.useCallback)(function(){if(n&&a&&G&&new Date(n)<new Date(x)){var e;(e=_async_to_generator(function(){return _ts_generator(this,function(e){switch(e.label){case 0:return[4,y.Tl.emit(f.Z.FETCH_ALL_CHAINS_MISSING_TRANSACTIONS,{from:w,to:n,blockchains:Z})];case 1:return e.sent(),S(new Date(a)),k((0,p.n9)(new Date(a),29)),I(!0),[2]}})}),function(){return e.apply(this,arguments)})()}},[n,a,w,x]),z=(0,_.useCallback)(function(e){if(G){var t;(t=_async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:return[4,y.Tl.emit(f.Z.FETCH_ALL_CHAINS_MISSING_TRANSACTIONS,{from:new Date(n),to:new Date(a),blockchains:e})];case 1:return t.sent(),[2]}})}),function(){return t.apply(this,arguments)})()}},[]),updateCachedTransactionsPeriod=function(e,r,n){E(n),l.h.dispatch(s.K.actions.updateAllChainsCachedTransactionsPeriod({blockchains:Z.map(function(e){return e.id}),selectedWalletId:t,from:e,to:r,nextToken:n}))},U=(e=_async_to_generator(function(e){var r,i,u,c,_,h,d,b,g;return _ts_generator(this,function(v){switch(v.label){case 0:return r=e.pageParam,K.current++,[4,y.Tl.emit(f.Z.FETCH_ASSETS_TRANSACTION_HISTORY,{from:r.from,to:r.to,nextToken:r.nextToken,blockchains:Z})];case 1:return u=(i=v.sent()).transactions,c=i.nextToken,_=i.unsupportedChains,h=r.from,d=r.to,b=c,(null==u?void 0:u.length)&&l.h.dispatch(s.K.actions.updateTxs({items:u,walletId:t})),(null==_?void 0:_.length)&&(j(_),(null==o?void 0:o.length)&&(g=m.filter(function(e){return!_.includes(e.id)}).filter(function(e){return!o.includes(e.id)})).length>0&&z(g)),n||updateCachedTransactionsPeriod(w.toISOString(),x.toISOString()),r.from>new Date(n)&&x<new Date(n)&&(updateCachedTransactionsPeriod(w.toISOString(),a,F),h=(0,p.n9)(new Date(a),-29),d=new Date(a),b=void 0),(r.to<new Date(a)||new Date(a).getTime()===r.to.getTime()&&b!==F)&&updateCachedTransactionsPeriod(n,x.toISOString(),b),C&&I(!1),S(h),k(d),O(!(null==u?void 0:u.length)),q(),[2,{transactions:u,from:h,to:d,nextToken:b}]}})}),function(t){return e.apply(this,arguments)}),W=(0,c.N)({queryKey:["transactions",t],queryFn:U,refetchOnWindowFocus:!1,refetchOnReconnect:!1,staleTime:3e5,gcTime:864e5,enabled:G,initialPageParam:{from:w,to:x,nextToken:void 0},getNextPageParam:function(e){if(!(x<=h.gs)&&null!==e){if(C)return{from:w,to:x,nextToken:F};if(e.nextToken||F){var t;return{nextToken:null!=(t=e.nextToken)?t:F,from:w,to:x}}return{from:new Date(e.to.getTime()),to:(0,p.n9)(e.to,29)}}}}),Y=W.fetchNextPage,$=W.hasNextPage,Q=W.isFetchingNextPage;return(0,_.useEffect)(function(){N&&K.current>1&&x>h.gs&&Y(),O(!1)},[N]),(0,_.useEffect)(function(){return function(){g.removeQueries(),L(!1)}},[]),{fetchNextPage:Y,hasNextPage:$,isFetchingNextPage:Q,isFirstFetch:K.current<2}}var m=r(80264),g=r(96492),v=r(90738),w=r(86896),S=r(67294);function history_array_like_to_array(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function history_array_with_holes(e){if(Array.isArray(e))return e}function history_iterable_to_array_limit(e,t){var r,n,a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var o=[],i=!0,l=!1;try{for(a=a.call(e);!(i=(r=a.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(e){l=!0,n=e}finally{try{i||null==a.return||a.return()}finally{if(l)throw n}}return o}}function history_non_iterable_rest(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function history_sliced_to_array(e,t){return history_array_with_holes(e)||history_iterable_to_array_limit(e,t)||history_unsupported_iterable_to_array(e,t)||history_non_iterable_rest()}function history_unsupported_iterable_to_array(e,t){if(e){if("string"==typeof e)return history_array_like_to_array(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return history_array_like_to_array(e,t)}}let T=(0,i.K)(function(){(0,o.d)({event:a.pG.HISTORY,props:null});var e=(0,w.Z)().formatMessage,t=(0,m.K)(),r=window.innerHeight-g.T5-g.sc-g.Lv-64,i=history_sliced_to_array((0,_.useState)(!0),2),l=i[0],s=i[1],u=useFetchMultipleChainsTransactions(),c=u.fetchNextPage,f=u.hasNextPage,h=u.isFetchingNextPage,y=u.isFirstFetch;return(0,_.useEffect)(function(){(Object.keys(t).length||!y)&&s(!1)},[t]),S.createElement(g._z,null,S.createElement(g.mr,{title:e({id:"history-list.title"})}),S.createElement(g.xV,null,S.createElement(v.Z,{dataLength:Object.values(t).flat().length,next:c,height:r,className:"tw-scrollbar",hasMore:!!f,loader:null,style:{display:"flex",flexDirection:"column"}},S.createElement(n.z,{transactions:t,scrollableAreaHeight:r,loadMoreItems:c,fetchingTransactions:h||l,hasNextPage:f,historyAvailable:!0}))))})}}]);